<!DOCTYPE html>
<html>
<head>
    <title>Notes Hub - Admin Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Login Card */
        .login-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            max-width: 400px;
            margin: 50px auto;
        }
        
        .login-card h1 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }
        
        button:hover {
            background: #45a049;
        }
        
        .logout-btn {
            background: #f44336;
            width: auto;
            padding: 8px 16px;
        }
        
        /* Dashboard */
        .dashboard {
            display: none;
        }
        
        .header {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: bold;
        }
        
        .tab.active {
            border-bottom: 3px solid #4CAF50;
            background: #f1f8e9;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        /* Upload Form */
        .upload-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .upload-card h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        /* Notes Container */
        .notes-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .notes-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .note-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .note-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .note-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background: #d4edda;
            color: #155724;
        }
        
        .note-meta {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .note-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .approve-btn {
            background: #4CAF50;
            color: white;
        }
        
        .reject-btn {
            background: #f44336;
            color: white;
        }
        
        .view-btn {
            background: #2196F3;
            color: white;
        }
        
        .delete-btn {
            background: #ff9800;
            color: white;
        }
        
        /* File Input */
        .file-input-container {
            position: relative;
            margin: 10px 0;
        }
        
        .file-input {
            opacity: 0;
            position: absolute;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-label {
            display: block;
            padding: 40px 20px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            text-align: center;
            background: #f9f9f9;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-label:hover {
            border-color: #4CAF50;
            background: #f1f8e9;
        }
        
        .file-label i {
            font-size: 40px;
            color: #4CAF50;
            margin-bottom: 10px;
        }
        
        /* Messages */
        .message {
            padding: 12px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .loading {
            background: #e9ecef;
            color: #495057;
        }
        
        /* Progress Bar */
        .progress-container {
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="loginSection" class="login-card">
            <h1><i class="fas fa-lock"></i> Admin Login</h1>
            
            <input type="email" id="email" value="admin@noteshub.com" placeholder="Email">
            <input type="password" id="password" value="admin123" placeholder="Password">
            <button onclick="login()"><i class="fas fa-sign-in-alt"></i> Login</button>
            
            <div id="loginMessage"></div>
            
            <p style="margin-top: 20px; color: #666; font-size: 14px; text-align: center;">
                <strong>Default:</strong><br>
                Email: admin@noteshub.com<br>
                Password: admin123
            </p>
        </div>
        
        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="dashboard">
            <!-- Header -->
            <div class="header">
                <div>
                    <h1><i class="fas fa-tachometer-alt"></i> Notes Hub Admin Dashboard</h1>
                    <p id="welcomeMessage" style="color: #666;">Welcome</p>
                </div>
                <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
            
            <!-- Tabs -->
            <div class="tabs">
                <div class="tab active" onclick="switchTab('stats')">
                    <i class="fas fa-chart-bar"></i> Dashboard
                </div>
                <div class="tab" onclick="switchTab('upload')">
                    <i class="fas fa-upload"></i> Upload Notes
                </div>
                <div class="tab" onclick="switchTab('pending')">
                    <i class="fas fa-clock"></i> Pending (<span id="pendingTabCount">0</span>)
                </div>
                <div class="tab" onclick="switchTab('approved')">
                    <i class="fas fa-check-circle"></i> Approved Notes
                </div>
                <div class="tab" onclick="switchTab('manual')">
                    <i class="fas fa-database"></i> Manual Entry
                </div>
            </div>
            
            <!-- Tab Contents -->
            
            <!-- Stats Tab -->
            <div id="statsTab" class="tab-content active">
                <!-- Stats -->
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalNotes">0</div>
                        <div>Total Notes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingNotes" style="color: orange;">0</div>
                        <div>Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="approvedNotes" style="color: green;">0</div>
                        <div>Approved</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalUsers" style="color: blue;">0</div>
                        <div>Users</div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="upload-card">
                    <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
                    <div class="form-row">
                        <button onclick="switchTab('upload')"><i class="fas fa-file-upload"></i> Upload New Notes</button>
                        <button onclick="loadPendingNotes()"><i class="fas fa-sync-alt"></i> Refresh Pending</button>
                        <button onclick="loadApprovedNotes()"><i class="fas fa-eye"></i> View Approved</button>
                    </div>
                </div>
            </div>
            
            <!-- Upload Tab -->
            <div id="uploadTab" class="tab-content">
                <div class="upload-card">
                    <h2><i class="fas fa-cloud-upload-alt"></i> Admin Direct Upload</h2>
                    <p style="color: #666; margin-bottom: 20px;">
                        Upload notes, PYQs, syllabus directly as admin. These will be automatically approved.
                    </p>
                    
                    <form id="uploadForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Title *</label>
                                <input type="text" id="uploadTitle" placeholder="e.g., DBMS Notes Unit 1" required>
                            </div>
                            <div class="form-group">
                                <label>Course *</label>
                                <select id="uploadCourse" required>
                                    <option value="">Select Course</option>
                                    <option value="BTECH">BTECH</option>
                                    <option value="BCA">BCA</option>
                                    <option value="BBA">BBA</option>
                                    <option value="MBA">MBA</option>
                                    <option value="MCA">MCA</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Material Type *</label>
                                <select id="uploadType" required>
                                    <option value="">Select Type</option>
                                    <option value="notes">Notes</option>
                                    <option value="pyq">PYQ (Previous Year Questions)</option>
                                    <option value="imp_questions">Important Questions</option>
                                    <option value="syllabus">Syllabus</option>
                                    <option value="books">Books/Reference</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Subject</label>
                                <input type="text" id="uploadSubject" placeholder="e.g., Database Management">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Semester/Year</label>
                                <select id="uploadSemester">
                                    <option value="">Select Semester</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tags (comma separated)</label>
                                <input type="text" id="uploadTags" placeholder="e.g., dbms, sql, database">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="uploadDescription" rows="3" placeholder="Describe the material..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>Upload File *</label>
                            <div class="file-input-container">
                                <input type="file" id="uploadFile" class="file-input" required accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.jpg,.jpeg,.png">
                                <label for="uploadFile" class="file-label" id="fileLabel">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <div><strong>Click to upload file</strong></div>
                                    <div style="font-size: 12px; color: #666;">PDF, DOC, PPT, Images (Max 10MB)</div>
                                </label>
                            </div>
                            <div id="fileName" style="margin-top: 5px; color: #666; font-size: 14px;"></div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div class="progress-container">
                            <div class="progress-bar" id="progressBar">
                                <div class="progress-fill" id="progressFill"></div>
                            </div>
                            <div id="progressText" style="text-align: center; font-size: 12px; color: #666;"></div>
                        </div>
                        
                        <button type="submit" id="uploadButton">
                            <i class="fas fa-upload"></i> Upload & Approve
                        </button>
                    </form>
                    
                    <div id="uploadMessage"></div>
                </div>
            </div>
            
            <!-- Pending Notes Tab -->
            <div id="pendingTab" class="tab-content">
                <div class="notes-container">
                    <div class="notes-header">
                        <h2><i class="fas fa-clock"></i> Pending Notes (<span id="pendingCount">0</span>)</h2>
                        <div>
                            <button onclick="loadPendingNotes()" style="background: #666; width: auto;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div id="loadingMessage" class="message loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> Loading...
                    </div>
                    
                    <div id="messageContainer"></div>
                    
                    <div id="notesList">
                        <!-- Pending notes will appear here -->
                    </div>
                    
                    <div id="emptyState" style="text-align: center; padding: 40px; color: #666; display: none;">
                        <div style="font-size: 48px; margin-bottom: 10px;"><i class="fas fa-inbox"></i></div>
                        <h3>No Pending Notes</h3>
                        <p>All caught up! No notes pending approval.</p>
                    </div>
                </div>
            </div>
            
            <!-- Approved Notes Tab -->
            <div id="approvedTab" class="tab-content">
                <div class="notes-container">
                    <div class="notes-header">
                        <h2><i class="fas fa-check-circle"></i> Approved Notes</h2>
                        <div>
                            <button onclick="loadApprovedNotes()" style="background: #666; width: auto;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div id="approvedLoading" class="message loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> Loading approved notes...
                    </div>
                    
                    <div id="approvedMessage"></div>
                    
                    <div id="approvedList">
                        <!-- Approved notes will appear here -->
                    </div>
                    
                    <div id="approvedEmpty" style="text-align: center; padding: 40px; color: #666; display: none;">
                        <div style="font-size: 48px; margin-bottom: 10px;"><i class="fas fa-check-circle"></i></div>
                        <h3>No Approved Notes</h3>
                        <p>No notes have been approved yet.</p>
                    </div>
                </div>
            </div>
            
            <!-- Manual Entry Tab -->
            <div id="manualTab" class="tab-content">
                <div class="upload-card">
                    <h2><i class="fas fa-keyboard"></i> Manual Database Entry</h2>
                    <p style="color: #666; margin-bottom: 20px;">
                        Add notes directly to database (for external files already uploaded)
                    </p>
                    
                    <form id="manualForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Title *</label>
                                <input type="text" id="manualTitle" placeholder="Note title" required>
                            </div>
                            <div class="form-group">
                                <label>File Name/URL *</label>
                                <input type="text" id="manualFile" placeholder="e.g., dbms_notes.pdf" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Course *</label>
                                <select id="manualCourse" required>
                                    <option value="">Select Course</option>
                                    <option value="BTECH">BTECH</option>
                                    <option value="BCA">BCA</option>
                                    <option value="BBA">BBA</option>
                                    <option value="MBA">MBA</option>
                                    <option value="MCA">MCA</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Type *</label>
                                <select id="manualType" required>
                                    <option value="notes">Notes</option>
                                    <option value="pyq">PYQ</option>
                                    <option value="imp_questions">Important Questions</option>
                                    <option value="syllabus">Syllabus</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="manualDescription" rows="3"></textarea>
                        </div>
                        
                        <button type="submit" id="manualButton">
                            <i class="fas fa-database"></i> Add to Database
                        </button>
                    </form>
                    
                    <div id="manualMessage"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let token = '';
        let user = null;
        
        // Test connection on load
        window.onload = function() {
            console.log('Testing connection...');
            testConnection();
            
            // Setup file upload display
            setupFileUpload();
            
            // Setup form submissions
            setupForms();
            
            // Check if already logged in
            const savedToken = localStorage.getItem('admin_token');
            const savedUser = localStorage.getItem('admin_user');
            
            if (savedToken && savedUser) {
                token = savedToken;
                user = JSON.parse(savedUser);
                showDashboard();
                loadStats();
                loadPendingNotes();
            }
        };
        
        // Setup file upload display
        function setupFileUpload() {
            const fileInput = document.getElementById('uploadFile');
            const fileName = document.getElementById('fileName');
            const fileLabel = document.getElementById('fileLabel');
            
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    const file = this.files[0];
                    fileName.textContent = `Selected: ${file.name} (${formatBytes(file.size)})`;
                    fileLabel.innerHTML = `
                        <i class="fas fa-file"></i>
                        <div><strong>${file.name}</strong></div>
                        <div style="font-size: 12px; color: #666;">Click to change file</div>
                    `;
                }
            });
        }
        
        // Setup form submissions
        function setupForms() {
            // Upload form
            document.getElementById('uploadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                uploadFile();
            });
            
            // Manual form
            document.getElementById('manualForm').addEventListener('submit', function(e) {
                e.preventDefault();
                manualAdd();
            });
        }
        
        // Format bytes to readable size
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        // Test backend connection
        async function testConnection() {
            try {
                const response = await fetch('http://localhost:5000/api/health');
                if (response.ok) {
                    console.log('✅ Backend connected');
                }
            } catch (error) {
                showLoginMessage('⚠️ Backend not running. Start server first.', 'error');
            }
        }
        
        // Login
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showLoginMessage('Please enter email and password', 'error');
                return;
            }
            
            showLoginMessage('Logging in...', 'loading');
            
            try {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    token = data.access_token;
                    user = data.user;
                    
                    // Save to localStorage
                    localStorage.setItem('admin_token', token);
                    localStorage.setItem('admin_user', JSON.stringify(user));
                    
                    showLoginMessage('✅ Login successful!', 'success');
                    
                    setTimeout(() => {
                        showDashboard();
                        loadStats();
                        loadPendingNotes();
                    }, 1000);
                    
                } else {
                    showLoginMessage('❌ Login failed: ' + data.error, 'error');
                }
            } catch (error) {
                showLoginMessage('❌ Connection error: ' + error.message, 'error');
            }
        }
        
        // Show dashboard
        function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            
            if (user) {
                document.getElementById('welcomeMessage').textContent = 
                    'Welcome, ' + user.name + ' (' + user.email + ')';
            }
        }
        
        // Logout
        function logout() {
            token = '';
            user = null;
            localStorage.removeItem('admin_token');
            localStorage.removeItem('admin_user');
            
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('password').value = '';
            
            showLoginMessage('Logged out successfully', 'success');
        }
        
        // Switch tabs
        function switchTab(tabName) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Load data if needed
            if (tabName === 'approved') {
                loadApprovedNotes();
            } else if (tabName === 'pending') {
                loadPendingNotes();
            }
        }
        
        // Load stats
        async function loadStats() {
            try {
                const response = await fetch('http://localhost:5000/api/admin/stats', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalNotes').textContent = data.stats.total_notes || 0;
                    document.getElementById('pendingNotes').textContent = data.stats.pending_notes || 0;
                    document.getElementById('approvedNotes').textContent = data.stats.approved_notes || 0;
                    document.getElementById('totalUsers').textContent = data.stats.total_users || 0;
                    
                    // Update tab count
                    document.getElementById('pendingTabCount').textContent = data.stats.pending_notes || 0;
                }
            } catch (error) {
                console.error('Stats error:', error);
            }
        }
        
        // Load pending notes
        async function loadPendingNotes() {
            const loadingEl = document.getElementById('loadingMessage');
            const notesListEl = document.getElementById('notesList');
            const emptyStateEl = document.getElementById('emptyState');
            
            loadingEl.style.display = 'block';
            notesListEl.innerHTML = '';
            emptyStateEl.style.display = 'none';
            
            try {
                const response = await fetch('http://localhost:5000/api/admin/pending-notes', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                
                const data = await response.json();
                loadingEl.style.display = 'none';
                
                if (data.success) {
                    const notes = data.notes || [];
                    document.getElementById('pendingCount').textContent = notes.length;
                    document.getElementById('pendingTabCount').textContent = notes.length;
                    
                    if (notes.length === 0) {
                        emptyStateEl.style.display = 'block';
                        return;
                    }
                    
                    // Display notes
                    notes.forEach(note => {
                        const noteCard = createNoteCard(note, 'pending');
                        notesListEl.appendChild(noteCard);
                    });
                }
            } catch (error) {
                loadingEl.style.display = 'none';
                showMessage('Error loading notes: ' + error.message, 'error');
            }
        }
        
        // Load approved notes
        async function loadApprovedNotes() {
            const loadingEl = document.getElementById('approvedLoading');
            const notesListEl = document.getElementById('approvedList');
            const emptyStateEl = document.getElementById('approvedEmpty');
            
            loadingEl.style.display = 'block';
            notesListEl.innerHTML = '';
            emptyStateEl.style.display = 'none';
            
            try {
                const response = await fetch('http://localhost:5000/api/admin/approved-notes', {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                
                const data = await response.json();
                loadingEl.style.display = 'none';
                
                if (data.success) {
                    const notes = data.notes || [];
                    
                    if (notes.length === 0) {
                        emptyStateEl.style.display = 'block';
                        return;
                    }
                    
                    // Display notes
                    notes.forEach(note => {
                        const noteCard = createNoteCard(note, 'approved');
                        notesListEl.appendChild(noteCard);
                    });
                }
            } catch (error) {
                loadingEl.style.display = 'none';
                showMessage('Error loading approved notes: ' + error.message, 'error', 'approvedMessage');
            }
        }
        
        // Create note card
        function createNoteCard(note, status) {
            const noteCard = document.createElement('div');
            noteCard.className = 'note-card';
            noteCard.id = 'note-' + note.id;
            
            const date = new Date(note.uploaded_at || note.created_at).toLocaleString();
            const statusClass = status === 'approved' ? 'status-approved' : 'status-pending';
            const statusText = status === 'approved' ? '✅ Approved' : '⏳ Pending';
            
            noteCard.innerHTML = `
                <div class="note-header">
                    <div class="note-title">${note.title}</div>
                    <div class="note-status ${statusClass}">${statusText}</div>
                </div>
                
                <div class="note-meta">
                    <div><strong>Course:</strong> ${note.course_name || note.course || 'Unknown'}</div>
                    <div><strong>Type:</strong> ${note.type || 'Note'}</div>
                    ${note.uploader_name ? `<div><strong>Uploaded by:</strong> ${note.uploader_name}</div>` : ''}
                    <div><strong>Date:</strong> ${date}</div>
                    <div><strong>File:</strong> ${note.original_filename || note.file_name || 'No file'}</div>
                </div>
                
                ${note.description ? `
                <div style="margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 5px;">
                    <strong>Description:</strong> ${note.description.substring(0, 200)}${note.description.length > 200 ? '...' : ''}
                </div>
                ` : ''}
                
                <div class="note-actions">
                    ${status === 'pending' ? `
                    <button class="action-btn approve-btn" onclick="approveNote(${note.id})">
                        <i class="fas fa-check"></i> Approve
                    </button>
                    <button class="action-btn reject-btn" onclick="rejectNote(${note.id})">
                        <i class="fas fa-times"></i> Reject
                    </button>
                    ` : ''}
                    
                    ${note.file_name ? `
                    <button class="action-btn view-btn" onclick="viewFile('${note.file_name}')">
                        <i class="fas fa-eye"></i> View
                    </button>
                    ` : ''}
                    
                    <button class="action-btn delete-btn" onclick="deleteNote(${note.id})">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            `;
            
            return noteCard;
        }
        
        // Upload file (Admin direct upload)
        async function uploadFile() {
            const formData = new FormData();
            const fileInput = document.getElementById('uploadFile');
            
            if (!fileInput.files[0]) {
                showMessage('Please select a file', 'error', 'uploadMessage');
                return;
            }
            
            // Get form values
            const title = document.getElementById('uploadTitle').value;
            const course = document.getElementById('uploadCourse').value;
            const type = document.getElementById('uploadType').value;
            const subject = document.getElementById('uploadSubject').value;
            const semester = document.getElementById('uploadSemester').value;
            const tags = document.getElementById('uploadTags').value;
            const description = document.getElementById('uploadDescription').value;
            
            // Validate
            if (!title || !course || !type) {
                showMessage('Please fill all required fields', 'error', 'uploadMessage');
                return;
            }
            
            // Prepare form data
            formData.append('file', fileInput.files[0]);
            formData.append('title', title);
            formData.append('course', course);
            formData.append('type', type);
            formData.append('subject', subject);
            formData.append('semester', semester);
            formData.append('tags', tags);
            formData.append('description', description);
            formData.append('is_admin_upload', 'true');
            formData.append('auto_approve', 'true');
            
            // Show progress
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const uploadButton = document.getElementById('uploadButton');
            
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
            progressText.textContent = 'Starting upload...';
            uploadButton.disabled = true;
            uploadButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
            
            try {
                const xhr = new XMLHttpRequest();
                
                // Progress tracking
                xhr.upload.addEventListener('progress', function(e) {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        progressFill.style.width = percentComplete + '%';
                        progressText.textContent = `Uploading: ${Math.round(percentComplete)}%`;
                    }
                });
                
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        progressText.textContent = 'Processing...';
                        
                        try {
                            const data = JSON.parse(xhr.responseText);
                            
                            if (xhr.status === 200 && data.success) {
                                progressFill.style.width = '100%';
                                progressText.textContent = 'Upload complete!';
                                
                                showMessage('✅ File uploaded and approved successfully!', 'success', 'uploadMessage');
                                
                                // Reset form
                                document.getElementById('uploadForm').reset();
                                document.getElementById('fileName').textContent = '';
                                document.getElementById('fileLabel').innerHTML = `
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <div><strong>Click to upload file</strong></div>
                                    <div style="font-size: 12px; color: #666;">PDF, DOC, PPT, Images (Max 10MB)</div>
                                `;
                                
                                // Update stats
                                loadStats();
                                
                                // Switch to approved tab and refresh
                                setTimeout(() => {
                                    switchTab('approved');
                                    loadApprovedNotes();
                                }, 1500);
                                
                            } else {
                                showMessage('❌ Upload failed: ' + (data.error || 'Unknown error'), 'error', 'uploadMessage');
                            }
                        } catch (error) {
                            showMessage('❌ Upload failed: ' + error.message, 'error', 'uploadMessage');
                        } finally {
                            setTimeout(() => {
                                progressBar.style.display = 'none';
                                uploadButton.disabled = false;
                                uploadButton.innerHTML = '<i class="fas fa-upload"></i> Upload & Approve';
                            }, 1000);
                        }
                    }
                };
                
                xhr.open('POST', 'http://localhost:5000/api/admin/upload');
                xhr.setRequestHeader('Authorization', 'Bearer ' + token);
                xhr.send(formData);
                
            } catch (error) {
                progressBar.style.display = 'none';
                uploadButton.disabled = false;
                uploadButton.innerHTML = '<i class="fas fa-upload"></i> Upload & Approve';
                showMessage('❌ Upload error: ' + error.message, 'error', 'uploadMessage');
            }
        }
        
        // Manual add to database
        async function manualAdd() {
            const title = document.getElementById('manualTitle').value;
            const file = document.getElementById('manualFile').value;
            const course = document.getElementById('manualCourse').value;
            const type = document.getElementById('manualType').value;
            const description = document.getElementById('manualDescription').value;
            
            if (!title || !file || !course) {
                showMessage('Please fill all required fields', 'error', 'manualMessage');
                return;
            }
            
            const button = document.getElementById('manualButton');
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            
            try {
                const response = await fetch('http://localhost:5000/api/admin/add-note', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        file_name: file,
                        course: course,
                        type: type,
                        description: description,
                        status: 'approved',
                        is_admin_upload: true
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showMessage('✅ Note added to database successfully!', 'success', 'manualMessage');
                    
                    // Reset form
                    document.getElementById('manualForm').reset();
                    
                    // Update stats
                    loadStats();
                    
                } else {
                    showMessage('❌ Failed: ' + data.error, 'error', 'manualMessage');
                }
            } catch (error) {
                showMessage('❌ Error: ' + error.message, 'error', 'manualMessage');
            } finally {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-database"></i> Add to Database';
            }
        }
        
        // Approve note
        async function approveNote(noteId) {
            if (!confirm('Approve this note?')) return;
            
            try {
                const response = await fetch(`http://localhost:5000/api/admin/notes/${noteId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: '{}'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Remove from pending list
                    const noteEl = document.getElementById('note-' + noteId);
                    if (noteEl) noteEl.remove();
                    
                    // Update counts
                    loadStats();
                    updatePendingCount();
                    
                    showMessage('✅ Note approved successfully!', 'success');
                } else {
                    showMessage('❌ Error: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('❌ Error: ' + error.message, 'error');
            }
        }
        
        // Reject note
        async function rejectNote(noteId) {
            const reason = prompt('Enter rejection reason:', 'Content does not meet guidelines');
            if (!reason) return;
            
            try {
                const response = await fetch(`http://localhost:5000/api/admin/notes/${noteId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason: reason })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Remove from list
                    const noteEl = document.getElementById('note-' + noteId);
                    if (noteEl) noteEl.remove();
                    
                    // Update counts
                    loadStats();
                    updatePendingCount();
                    
                    showMessage('✅ Note rejected!', 'success');
                } else {
                    showMessage('❌ Error: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('❌ Error: ' + error.message, 'error');
            }
        }
        
        // Delete note
        async function deleteNote(noteId) {
            if (!confirm('Delete this note permanently?')) return;
            
            try {
                const response = await fetch(`http://localhost:5000/api/admin/notes/${noteId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Remove from list
                    const noteEl = document.getElementById('note-' + noteId);
                    if (noteEl) noteEl.remove();
                    
                    // Update counts
                    loadStats();
                    updatePendingCount();
                    
                    showMessage('✅ Note deleted!', 'success');
                } else {
                    showMessage('❌ Error: ' + data.error, 'error');
                }
            } catch (error) {
                showMessage('❌ Error: ' + error.message, 'error');
            }
        }
        
        // View file
        function viewFile(filename) {
            window.open('http://localhost:5000/api/files/' + filename, '_blank');
        }
        
        // Update pending count
        function updatePendingCount() {
            const notes = document.querySelectorAll('#notesList .note-card');
            const count = notes.length;
            
            document.getElementById('pendingCount').textContent = count;
            document.getElementById('pendingTabCount').textContent = count;
            
            if (count === 0) {
                document.getElementById('emptyState').style.display = 'block';
            }
        }
        
        // Show message
        function showMessage(text, type, containerId = 'messageContainer') {
            const container = document.getElementById(containerId);
            const messageEl = document.createElement('div');
            messageEl.className = 'message ' + type;
            messageEl.textContent = text;
            container.appendChild(messageEl);
            
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.remove();
                }
            }, 3000);
        }
        
        // Show login message
        function showLoginMessage(text, type) {
            const el = document.getElementById('loginMessage');
            el.textContent = text;
            el.className = 'message ' + type;
        }
    </script>
</body>
</html>
